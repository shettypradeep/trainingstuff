From users-return-136204-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Fri Apr 18 18:33:45 2014
Return-Path: <users-return-136204-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id DAD1011C76
	for <apmail-maven-users-archive@www.apache.org>; Fri, 18 Apr 2014 18:33:45 +0000 (UTC)
Received: (qmail 72718 invoked by uid 500); 18 Apr 2014 18:33:10 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 72662 invoked by uid 500); 18 Apr 2014 18:33:03 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 72650 invoked by uid 99); 18 Apr 2014 18:33:02 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 18 Apr 2014 18:33:02 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=5.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of maven.2.user@gmail.com designates 209.85.192.47 as permitted sender)
Received: from [209.85.192.47] (HELO mail-qg0-f47.google.com) (209.85.192.47)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 18 Apr 2014 18:32:58 +0000
Received: by mail-qg0-f47.google.com with SMTP id i50so1962063qgf.34
        for <users@maven.apache.org>; Fri, 18 Apr 2014 11:32:37 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        bh=6QZMH0v9JG4/zA1fl9m1dzh/rgBfc3YlimtSBh0r9do=;
        b=qNbwk6ANgEMhwb8VvX5EmurejSrRGLk55zMZm8YGrwbJlYDhA7hoMVwW3RPzV8lbLx
         X8SHu4gzxZVZcueedKEMh8hTyiiGBXw+Hgtn5TrJyChDdvslmnQZ9fXqmT6oJ0jlmK83
         JQlRe6ufgWkxy0/hqxCK15tn5hLpbDerN+s6vXFCCvmEmaZbDX7lnbWyFQ63n7rEe5cj
         6HUngMqeK465rPgyyISAxnI6dMGRw1fn/MCQsDy3KpkZJk5BwUHaPpo98Nk8p3BDmE4j
         eJemZ3bXLFWh37DaJ7jrw4LLltN3inX+qV1JcqyX/H1kfq5JJ/nW1JcxByAb9VznuXhX
         Ff4A==
MIME-Version: 1.0
X-Received: by 10.140.49.109 with SMTP id p100mr26562562qga.47.1397845957554;
 Fri, 18 Apr 2014 11:32:37 -0700 (PDT)
Received: by 10.140.106.3 with HTTP; Fri, 18 Apr 2014 11:32:37 -0700 (PDT)
In-Reply-To: <CAChPNbfabK-+0kQLb1z-DepHSQ70HEK9=Y9G84qZ55AK95q-qA@mail.gmail.com>
References: <CAChPNbexJ3vix-HdFNiKSEQrOYMW+vjxHknCn7-fPp0LsKxLBw@mail.gmail.com>
	<CAEayHEPxqeWPyCgR1bmoGx-oGxr-TvkRxU4JewuY8aXzt80OHg@mail.gmail.com>
	<CA+nPnMy691eXxCmxMrc=C1uzZnSwYu0ZxLAhfKSq8HJsUDYKxA@mail.gmail.com>
	<CAChPNbfdTVUkN63=3C1i94fDKPo9jrOgrBf_zjhWVjJWdUwNGQ@mail.gmail.com>
	<CAChPNbcuj24zrAwC_1sgSMUxPCfetcK9NZ8xnAY+9ToGQfwGvg@mail.gmail.com>
	<CAChPNbeR2NdWLcKDhAPJwYsYKurfxmvG+h-BUG58ZFDmAhX0mQ@mail.gmail.com>
	<CAChPNbfN3=yz-1RkyA3W0j-_t+Z6jK_Ak1bQzh7TN9tbQemD7w@mail.gmail.com>
	<CAChPNbfBPz0_tsXN=YjYNrdSFSveSSREzzKgCtZO1+uMgfnNiw@mail.gmail.com>
	<CA+nPnMxZj0zui9QJZy8Vc3CUapPcTonxDSGMFgvH0MHb250xwA@mail.gmail.com>
	<CAChPNbfabK-+0kQLb1z-DepHSQ70HEK9=Y9G84qZ55AK95q-qA@mail.gmail.com>
Date: Fri, 18 Apr 2014 14:32:37 -0400
Message-ID: <CAChPNbe77ScDg0u51mcHCV98Ru19B4u=1SKi6cNHnzYD39sopA@mail.gmail.com>
Subject: Re: Struggling to release:perform with git and deployer key
From: Maven User <maven.2.user@gmail.com>
To: Maven Users List <users@maven.apache.org>
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
X-Virus-Checked: Checked by ClamAV on apache.org

Additionally, this whole thing is pretty confusing if you're new to
all of this (we have been releasing forever but with OTHER scm
systems).

I wish somewhere, this was called out explicitly - should I update
some wiki page or documentation around the GIT scm provider?



On Fri, Apr 18, 2014 at 2:25 PM, Maven User <maven.2.user@gmail.com> wrote:
> So for anyone else that stumbles across this thread, here's what you need=
:
>
> PLEASE note - I tend to have singular, non-multi-module maven builds.
> One repo per module kinda belief.
>
> 1 - The credentials plugin - allows you to let jenkins manage some privat=
e keys.
> 2 - The ssh-agent plugin - allows you to let the jenkins process to
> have that key in its ssh-agent as the process runs
> 3 - deployer keys for each github repo you want
> -------------------------------
> 1 - Generate the deployer keys
> (https://help.github.com/articles/managing-deploy-keys)
> 2 - Take the private key and store it in jenkins via the credentials plug=
in
> 3 - Any maven release project you want to release back to github, make
> sure you specify the credentials in the git config AND turn on
> ssh-agent in the build section
>
>
>
>
> On Fri, Apr 18, 2014 at 1:25 PM, Stephen Connolly
> <stephen.alan.connolly@gmail.com> wrote:
>> Ahh you should have just said you were doing this on jenkins.... I wrote
>> the ssh-agent plugin for this exact use case!
>>
>>
>> On 18 April 2014 18:01, Maven User <maven.2.user@gmail.com> wrote:
>>
>>> That was it!
>>>
>>> Ok, so for the record, if you're going to use the credentials plugin,
>>> you should also use the ssh-agent plugin to make sure those keys are
>>> available to any processes being run by jenkins!
>>>
>>> On Fri, Apr 18, 2014 at 12:53 PM, Maven User <maven.2.user@gmail.com>
>>> wrote:
>>> > Annnd this is because I tried to reuse ${artifactId} and that does NO=
T
>>> > match the repo name (for acceptable reasons).
>>> >
>>> > Changing and retrying...
>>> >
>>> > On Fri, Apr 18, 2014 at 12:47 PM, Maven User <maven.2.user@gmail.com>
>>> wrote:
>>> >> Using the ssh-agent jenkins plugin, I'm able to get a bit further -
>>> >> now it's complaining the repository doesn't exist:
>>> >>
>>> >> Unable to commit files
>>> >> 00:01:14.796 Provider message:
>>> >> 00:01:14.796 The git-push command failed.
>>> >> 00:01:14.796 Command output:
>>> >> 00:01:14.796 ERROR: Repository not found.
>>> >> 00:01:14.796 fatal: The remote end hung up unexpectedly
>>> >>
>>> >> I'm guessing this is an error in my <scm> tags....
>>> >>
>>> >>
>>> >>
>>> >> On Fri, Apr 18, 2014 at 11:55 AM, Maven User <maven.2.user@gmail.com=
>
>>> wrote:
>>> >>> Interesting....
>>> >>>
>>> >>> Running:
>>> >>> eval `ssh-agent -s`
>>> >>>
>>> >>> Then the ssh -T test results in success.
>>> >>>
>>> >>> But that's only good for the single bash session.
>>> >>>
>>> >>> Are people running jenkins as normal users versus unprivileged user=
s?
>>> >>>
>>> >>> On Fri, Apr 18, 2014 at 11:38 AM, Maven User <maven.2.user@gmail.co=
m>
>>> wrote:
>>> >>>> Stephen - cool - I _do_ have that and am pointing at the file in t=
hat
>>> path.
>>> >>>>
>>> >>>> Again, I'm using the "managed file" plugin to drop down that priva=
te
>>> key.
>>> >>>>
>>> >>>> Strangely, when I run this command:
>>> >>>>
>>> >>>> ssh -vT git@github.com
>>> >>>>
>>> >>>> I get back:
>>> >>>> ...
>>> >>>> debug1: Connection established.
>>> >>>> debug1: identity file /srv/jenkins/.ssh/id_rsa type 1
>>> >>>> ...
>>> >>>> debug1: Authentications that can continue: publickey
>>> >>>> debug1: Next authentication method: publickey
>>> >>>> debug1: Offering RSA public key: /srv/jenkins/.ssh/id_rsa
>>> >>>> debug1: Authentications that can continue: publickey
>>> >>>> debug1: Trying private key: /srv/jenkins/.ssh/id_dsa
>>> >>>> debug1: Trying private key: /srv/jenkins/.ssh/id_ecdsa
>>> >>>> debug1: No more authentication methods to try.
>>> >>>> Permission denied (publickey).
>>> >>>>
>>> >>>> Any more suggestions?
>>> >>>>
>>> >>>>
>>> >>>> On Fri, Apr 18, 2014 at 11:31 AM, Stephen Connolly
>>> >>>> <stephen.alan.connolly@gmail.com> wrote:
>>> >>>>>     <server>
>>> >>>>>
>>> >>>>>       <id>...</id>
>>> >>>>>
>>> >>>>>       <username>...</username>
>>> >>>>>
>>> >>>>>       <password>...</password>
>>> >>>>>
>>> >>>>>       <privateKey>/home/.../.ssh/id_rsa</privateKey>
>>> >>>>>
>>> >>>>>     </server>
>>> >>>>>
>>> >>>>>
>>> >>>>> On 18 April 2014 16:27, Thomas Broyer <t.broyer@gmail.com> wrote:
>>> >>>>>
>>> >>>>>> I think by default Maven calls the command-line Git, so it uses =
the
>>> >>>>>> ~/.ssh/id_rsa, and not the configuration from your settings.xml.
>>> >>>>>> I have no idea if what you're trying to do is possible with Mave=
n.
>>> Maybe
>>> >>>>>> the maven-scm-provider-jgit would use the settings.xml
>>> configuration, but I
>>> >>>>>> have no idea how to configure Maven to use it.
>>> >>>>>>
>>> >>>>>>
>>> >>>>>> On Fri, Apr 18, 2014 at 3:45 PM, Maven User <maven.2.user@gmail.=
com
>>> >
>>> >>>>>> wrote:
>>> >>>>>>
>>> >>>>>> > Hi all -
>>> >>>>>> >
>>> >>>>>> > I'm really struggling with this.
>>> >>>>>> >
>>> >>>>>> > My git push portion of the maven release process just is quitt=
ing
>>> with
>>> >>>>>> > this:
>>> >>>>>> >
>>> >>>>>> > 00:01:29.803 Provider message:
>>> >>>>>> > 00:01:29.803 The git-push command failed.
>>> >>>>>> > 00:01:29.803 Command output:
>>> >>>>>> > 00:01:29.803 Permission denied (publickey).
>>> >>>>>> > 00:01:29.803 fatal: The remote end hung up unexpectedly
>>> >>>>>> > 00:01:29.803
>>> >>>>>> > 00:01:29.803 cause : Unable to commit files
>>> >>>>>> > 00:01:29.803 Provider message:
>>> >>>>>> > 00:01:29.803 The git-push command failed.
>>> >>>>>> > 00:01:29.803 Command output:
>>> >>>>>> > 00:01:29.803 Permission denied (publickey).
>>> >>>>>> > 00:01:29.803 fatal: The remote end hung up unexpectedly
>>> >>>>>> >
>>> >>>>>> > I have the key stored in Jenkins as a "managed file" (as part =
of
>>> that
>>> >>>>>> > plugin).  So the build has an early step where that key is
>>> written to
>>> >>>>>> > disk.
>>> >>>>>> >
>>> >>>>>> > Then I've used the settings.xml to specify which key to use
>>> (pointing
>>> >>>>>> > at that location just above).
>>> >>>>>> >
>>> >>>>>> >  <server>
>>> >>>>>> >       <id>github.com</id>
>>> >>>>>> >       <username>someusername</username>
>>> >>>>>> >       <privateKey>/srv/jenkins/.ssh/somekeyname</privateKey>
>>> >>>>>> >       <filePermissions>664</filePermissions>
>>> >>>>>> >       <directoryPermissions>775</directoryPermissions>
>>> >>>>>> >       <configuration></configuration>
>>> >>>>>> >     </server>
>>> >>>>>> >
>>> >>>>>> >   <scm>
>>> >>>>>> >       <connection>scm:git:git@github.com:
>>> >>>>>> > ${companyid}/${project.artifactId}.git</connection>
>>> >>>>>> >       <url>scm:git:git@github.com:
>>> >>>>>> > ${companyid}/${project.artifactId}.git</url>
>>> >>>>>> >       <developerConnection>scm:git:git@github.com:
>>> >>>>>> > ${companyid}/${project.artifactId}.git</developerConnection>
>>> >>>>>> >       <tag>HEAD</tag>
>>> >>>>>> >    </scm>
>>> >>>>>> >
>>> >>>>>> > What am I doing wrong?
>>> >>>>>> >
>>> >>>>>> >
>>> ---------------------------------------------------------------------
>>> >>>>>> > To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
>>> >>>>>> > For additional commands, e-mail: users-help@maven.apache.org
>>> >>>>>> >
>>> >>>>>> >
>>> >>>>>>
>>> >>>>>>
>>> >>>>>> --
>>> >>>>>> Thomas Broyer
>>> >>>>>> /t=C9=94.ma.b=CA=81wa.je/ <http://xn--nna.ma.xn--bwa-xxb.je/> <
>>> http://xn--nna.ma.xn--bwa-xxb.je/> <
>>> >>>>>> http://xn--nna.ma.xn--bwa-xxb.je/>
>>> >>>>>>
>>>
>>> ---------------------------------------------------------------------
>>> To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
>>> For additional commands, e-mail: users-help@maven.apache.org
>>>
>>>

---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


