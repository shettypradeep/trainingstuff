From users-return-136441-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Sat May 24 10:01:17 2014
Return-Path: <users-return-136441-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id E11081156D
	for <apmail-maven-users-archive@www.apache.org>; Sat, 24 May 2014 10:01:16 +0000 (UTC)
Received: (qmail 28345 invoked by uid 500); 24 May 2014 10:01:14 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 28256 invoked by uid 500); 24 May 2014 10:01:14 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 28248 invoked by uid 99); 24 May 2014 10:01:14 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 May 2014 10:01:14 +0000
X-ASF-Spam-Status: No, hits=1.5 required=5.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of stephen.alan.connolly@gmail.com designates 74.125.82.42 as permitted sender)
Received: from [74.125.82.42] (HELO mail-wg0-f42.google.com) (74.125.82.42)
    by apache.org (qpsmtpd/0.29) with ESMTP; Sat, 24 May 2014 10:01:10 +0000
Received: by mail-wg0-f42.google.com with SMTP id y10so5705420wgg.1
        for <users@maven.apache.org>; Sat, 24 May 2014 03:00:49 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        bh=rvV6t/6qSBa+akSmNya6Br5SzzM2YUFTtMQYkyVHPus=;
        b=RsEeP+2ATt/z8kTsNHOY6ynlbN/whbc/YRvjIHC14Cry4YAzyRvjs/5irPwjk87T/C
         Eaz5tLqZstAXXVIIYhlzMXLsjdomYOru6OCtkhSz3j+knCcaUtZrp2eIpVN4CDCD09yF
         86tZEBsw1XUqtOQC+HHDcJsqWApk97y//OvAvuJBaht3nLSavsI+EIhY/2bEVZIWzA5l
         lQQ6xU8GXCoLtuI/ZvZuRu1Y30yATPJw0Tk5uHiRqFU2pkV5q/TpX2KiZWN30w1ayJ7l
         uLGXFjLn/q66XGQDugF0XfhusuidaE1/66ne8fI+QJhmAuDmsMvmiJT+lWMSrSwR88yj
         7Bkw==
MIME-Version: 1.0
X-Received: by 10.180.210.238 with SMTP id mx14mr9667464wic.61.1400925649662;
 Sat, 24 May 2014 03:00:49 -0700 (PDT)
Received: by 10.194.205.233 with HTTP; Sat, 24 May 2014 03:00:49 -0700 (PDT)
In-Reply-To: <CALN=NUGYpE82sOz7aaSJUHRmrPAS+68EcyZoMJeyUNOEezTkww@mail.gmail.com>
References: <CALN=NUGYpE82sOz7aaSJUHRmrPAS+68EcyZoMJeyUNOEezTkww@mail.gmail.com>
Date: Sat, 24 May 2014 11:00:49 +0100
Message-ID: <CA+nPnMy3+uGpzUTVKwE7Zyox6-jfpnj8TPP+4SbRMX+cS6Mpng@mail.gmail.com>
Subject: Re: unit tests with multiple oracle, db2 etc
From: Stephen Connolly <stephen.alan.connolly@gmail.com>
To: Maven Users List <users@maven.apache.org>
Content-Type: multipart/alternative; boundary=001a11c26a42b47a6304fa226bc4
X-Virus-Checked: Checked by ClamAV on apache.org

--001a11c26a42b47a6304fa226bc4
Content-Type: text/plain; charset=UTF-8

Well first off, this is really an integration test... So I would switch to
have failsafe run the tests: ie add failsafe:integration-test and
failsafe:verify to your project's lifecycle (perhaps even in a profile)

Then I would use
http://maven.apache.org/surefire/maven-failsafe-plugin/integration-test-mojo.html#additionalClasspathElementsin
multiple executions of the failsafe:integration-test config to add the
different directories for each environment that you want to test against

So you would have:

* an execution of failsafe:verify bound to the verify phase to check all
the aggregate results
* an execution of failsafe:integration-test bound to the integration-test
phase with additionalClasspathElements pointing to
src/test/oracle-resources which has a test-context.xml pointing to the
oracle DB
* an execution of failsafe:integration-test bound to the integration-test
phase with additionalClasspathElements pointing to src/test/db2-resources
which has a test-context.xml pointing to the DB2 DB.
Etc

It's not completely ideal in that you are hard-coding the DB connection
detail in source control... If I were doing it I would seek to either only
enable the DB-specific integration tests based on the existence of the
corresponding test-context.xml (profile activation) source control would
have a test-config.xml.template and ignore the test-config.xml so that I
can have my own local test env that is separate from yours and we are not
fighting over who's test-config.xml to merge... Or I would use resource
filtering to inject the config by properties (activating the profile based
on the presence of the property). The second route would probably be more
verbose so I would probably write a helper plugin... Haven't needed to do
that yet, hence I haven't written such a plugin ;-)

HTH

- Stephen


On Friday, 23 May 2014, Gordon Cody <gordon.cody@zafin.com> wrote:

> We have to begin running junit tests using more than 1 database type. I am
> wondering how best to run all unit tests using oracle then run all of the
> tests again using db2 then postgres. I figured some of you out there must
> have a similar requirement.
>
> Currently we have test/resources/test-context.xml that contains
>     <bean id="dataSource"
>         class="org.apache.commons.dbcp.BasicDataSource"
>         destroy-method="close" lazy-init="true">
>         <property name="driverClassName"
> value="com.p6spy.engine.spy.P6SpyDriver" />
>         <property name="url" value="jdbc:oracle:thin:@localhost:1521:xxxx"
> />
>         <property name="username" value="xxxxx" />
>         <property name="password" value="xxxxx" />
>         <property name="accessToUnderlyingConnectionAllowed" value="true"
> />
>         <property name="defaultAutoCommit" value="false" />
>         <property name="maxWait" value="0" />
>         <property name="maxActive" value="-1" />
>     </bean>
>
> There is nothing in the pom.xml explicitly related to unit tests other than
>         <dependency>
>             <groupId>junit</groupId>
>             <artifactId>junit</artifactId>
>             <version>4.8.2</version>
>         </dependency>
>
> Quick sanity builds are done by our CI system using
> mvn package -e -Dmaen.test.skip=true
> Due to how long the tests take to complete they are only run daily using
> mvn test -e -Dtest=com.zafinlabs.someapp.somemodule.TestSomeProcess
>
> Suggestions please.
> --
> Best Regards, Gord Cody
>
> Release Manager  Zafin Labs Americas Inc.
> 179 Colonnade Road-Suite 100, Ottawa ON, Canada
> Phone: +1 (613) 216-2504  Fax: +1 (613) 688-1374  Mobile: +1 613-601-2734
> Web: http://zafin.com  Email: gordon.cody@zafin.com <javascript:;>
>
> --
> Zafin - Canada
>
> --
> http://zafin.com
>
> <http://zafin.com/>
>
> ------------------------------
>
> Connect with us
>
>  <http://www.youtube.com/user/ZafinGlobal> <
> http://www.linkedin.com/company/Zafin>
>   <http://twitter.com/Zafin>
>
> News and Events
>
> Zafin among Top 10 FinTech Companies to Watch in 2014: American Banker<
> http://zafin.com/zafin-among-top-10-fintech-companies-to-watch-in-2014-american-banker/
> >
>


-- 
Sent from my phone

--001a11c26a42b47a6304fa226bc4--

