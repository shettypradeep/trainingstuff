From users-return-136340-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Mon May 12 11:25:31 2014
Return-Path: <users-return-136340-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id 2CC6411060
	for <apmail-maven-users-archive@www.apache.org>; Mon, 12 May 2014 11:25:31 +0000 (UTC)
Received: (qmail 40332 invoked by uid 500); 12 May 2014 10:58:48 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 40238 invoked by uid 500); 12 May 2014 10:58:48 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 40230 invoked by uid 99); 12 May 2014 10:58:48 -0000
Received: from Unknown (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 May 2014 10:58:48 +0000
X-ASF-Spam-Status: No, hits=1.5 required=5.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy includes SPF record at spf.trusted-forwarder.org)
Received: from [209.85.212.173] (HELO mail-wi0-f173.google.com) (209.85.212.173)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 12 May 2014 10:58:42 +0000
Received: by mail-wi0-f173.google.com with SMTP id bs8so4233762wib.0
        for <users@maven.apache.org>; Mon, 12 May 2014 03:58:19 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20130820;
        h=x-gm-message-state:mime-version:date:message-id:subject:from:to
         :content-type;
        bh=ItZUmXOtg54tmz0WV2BZUvTazq0LSYUBl5aJ+Q2IWfw=;
        b=iqvyYbuP3afzDQSU8rsUdcoeUpxH0j7jHUEtaCRk6aXdD5MxUXaSukdqd8fD4UCR9F
         RwP7HbCyq1IDUXa9HFGDSmrjaerCmV2dupcpEzeZMbCZ+U33lApSQNiEoqNp2LyDXWcH
         vLZGZJ2vrRE6FEHRv4JKMxJS+qPfea8mz2dIOXx3jmkDgoxJnMIJfRFmYI31GVNmzvG1
         9S/Zk/FzHgkb8ZB5rb6iRPamFcs/IQ0i/UKGn8LmYN/zZZu8Glwb4lz0A82bOT0dQ6QD
         uovrGtS1fITnWl1IB3wyxvEKQbnEebGRVZiwsnNge6MUKs/W2CT7ptmqR+Afe4K6AhT1
         iXkQ==
X-Gm-Message-State: ALoCoQkzGIZY5eHiG5vLnA4YUusSC8G61YNNGQWaWmB5+ApZZbF7bgMX3Xg4CFsxitEyvo6DTFTQ
MIME-Version: 1.0
X-Received: by 10.194.100.67 with SMTP id ew3mr1390316wjb.57.1399892299456;
 Mon, 12 May 2014 03:58:19 -0700 (PDT)
Received: by 10.216.235.4 with HTTP; Mon, 12 May 2014 03:58:19 -0700 (PDT)
X-Originating-IP: [101.165.250.71]
Date: Mon, 12 May 2014 20:58:19 +1000
Message-ID: <CAEBcyzoHDucu-yEWCg7HDe1XW46QO8LZvtYcyYKp9Lacib9GjA@mail.gmail.com>
Subject: Wagon extensions not available from AbstractMavenLifecycleParticipant
 or maven-dependency-tree?
From: William Ferguson <william.ferguson@xandar.com.au>
To: Maven Users List <users@maven.apache.org>
Content-Type: multipart/alternative; boundary=089e0160c2723bb5ed04f931d361
X-Virus-Checked: Checked by ClamAV on apache.org

--089e0160c2723bb5ed04f931d361
Content-Type: text/plain; charset=UTF-8

I have a MavenLifecycleParticipant in my plugin. It uses
maven-dependency-tree to resolve some deps that we need to do extra
processing on. It works fine if the deps are in the local repo.

But if the s3 Wagon is defined in the project along with a dependency from
the s3 bucket, then the following debug log shows that
DependencyGraphBuilder of maven-dependency-tree can't resolve the s3 wagon,
and the dependency is not resolved now or later in the build, so
compilation fails.

NB If I remove the MavenLifecycleParticipant then the dep is resolved via
the S3 Wagon.

Q1) When are the Wagons configured? Shouldn't it be prior to
MavenLifecycleParticipant being called?
Q2) How can I get the DependencyGraphBuilder to resolve the s3 artifact
from within the MavenLifecycleParticipant?


Here is the stacktrace:

[DEBUG] Could not find metadata
com.viewpagerindicator:viewpagerindicator:2.4.2-SNAPSHOT/maven-metadata.xml
in local (D:\dev\maven-local-repository)
[DEBUG] java.util.NoSuchElementException
      role: org.apache.maven.wagon.Wagon
  roleHint: s3
org.codehaus.plexus.component.repository.exception.ComponentLookupException:
java.util.NoSuchElementException
      role: org.apache.maven.wagon.Wagon
  roleHint: s3
at
org.codehaus.plexus.DefaultPlexusContainer.lookup(DefaultPlexusContainer.java:264)
at
org.codehaus.plexus.DefaultPlexusContainer.lookup(DefaultPlexusContainer.java:252)
at
org.eclipse.aether.internal.connector.wagon.PlexusWagonProvider.lookup(PlexusWagonProvider.java:33)
at
org.eclipse.aether.connector.wagon.WagonRepositoryConnector.lookupWagon(WagonRepositoryConnector.java:337)
at
org.eclipse.aether.connector.wagon.WagonRepositoryConnector.<init>(WagonRepositoryConnector.java:157)
at
org.eclipse.aether.connector.wagon.WagonRepositoryConnectorFactory.newInstance(WagonRepositoryConnectorFactory.java:159)
at
org.eclipse.aether.internal.impl.DefaultRepositoryConnectorProvider.newRepositoryConnector(DefaultRepositoryConnectorProvider.java:139)
at
org.eclipse.aether.internal.impl.DefaultMetadataResolver$ResolveTask.run(DefaultMetadataResolver.java:613)
at
org.eclipse.aether.util.concurrency.RunnableErrorForwarder$1.run(RunnableErrorForwarder.java:67)
at
org.eclipse.aether.internal.impl.DefaultMetadataResolver$1.execute(DefaultMetadataResolver.java:540)
at
org.eclipse.aether.internal.impl.DefaultMetadataResolver.resolve(DefaultMetadataResolver.java:395)
at
org.eclipse.aether.internal.impl.DefaultMetadataResolver.resolveMetadata(DefaultMetadataResolver.java:218)
at
org.apache.maven.repository.internal.DefaultVersionResolver.resolveVersion(DefaultVersionResolver.java:250)
at
org.apache.maven.repository.internal.DefaultArtifactDescriptorReader.loadPom(DefaultArtifactDescriptorReader.java:284)
at
org.apache.maven.repository.internal.DefaultArtifactDescriptorReader.readArtifactDescriptor(DefaultArtifactDescriptorReader.java:217)
at
org.eclipse.aether.internal.impl.DefaultDependencyCollector.process(DefaultDependencyCollector.java:461)
at
org.eclipse.aether.internal.impl.DefaultDependencyCollector.collectDependencies(DefaultDependencyCollector.java:261)
at
org.eclipse.aether.internal.impl.DefaultRepositorySystem.collectDependencies(DefaultRepositorySystem.java:317)
at
org.apache.maven.project.DefaultProjectDependenciesResolver.resolve(DefaultProjectDependenciesResolver.java:159)
at
org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder.resolveDependencies(Maven31DependencyGraphBuilder.java:113)
at
org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder.buildDependencyGraph(Maven31DependencyGraphBuilder.java:99)
at
org.apache.maven.shared.dependency.graph.internal.DefaultDependencyGraphBuilder.buildDependencyGraph(DefaultDependencyGraphBuilder.java:74)
at
com.jayway.maven.plugins.android.common.DependencyResolver.getProjectDependenciesFor(DependencyResolver.java:54)
at
com.jayway.maven.plugins.android.phase_prebuild.ClasspathModifierLifecycleParticipant.afterProjectsRead(ClasspathModifierLifecycleParticipant.java:78)
at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:317)
at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:155)
at org.apache.maven.cli.MavenCli.execute(MavenCli.java:584)
at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:213)
at org.apache.maven.cli.MavenCli.main(MavenCli.java:157)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:606)
at
org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:289)
at
org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:229)
at
org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:415)
at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:356)


William

--089e0160c2723bb5ed04f931d361--

