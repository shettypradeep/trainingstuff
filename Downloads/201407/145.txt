From users-return-136826-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Tue Jul 22 14:50:31 2014
Return-Path: <users-return-136826-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id AA8B21169D
	for <apmail-maven-users-archive@www.apache.org>; Tue, 22 Jul 2014 14:50:31 +0000 (UTC)
Received: (qmail 89403 invoked by uid 500); 22 Jul 2014 14:50:23 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 89317 invoked by uid 500); 22 Jul 2014 14:50:23 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 89306 invoked by uid 99); 22 Jul 2014 14:50:23 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 22 Jul 2014 14:50:23 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=5.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: local policy)
Received: from [217.26.49.175] (HELO mxout015.mail.hostpoint.ch) (217.26.49.175)
    by apache.org (qpsmtpd/0.29) with ESMTP; Tue, 22 Jul 2014 14:50:18 +0000
Received: from [10.0.2.46] (helo=asmtp013.mail.hostpoint.ch)
	by mxout015.mail.hostpoint.ch with esmtp (Exim 4.82 (FreeBSD))
	(envelope-from <domi@fortysix.ch>)
	id 1X9bO7-000Edl-Ty
	for users@maven.apache.org; Tue, 22 Jul 2014 16:49:55 +0200
Received: from [31.24.12.193] (helo=[192.168.1.30])
	by asmtp013.mail.hostpoint.ch with esmtpsa (TLSv1:AES128-SHA:128)
	(Exim 4.82 (FreeBSD))
	(envelope-from <domi@fortysix.ch>)
	id 1X9bO7-000BSA-Rr
	for users@maven.apache.org; Tue, 22 Jul 2014 16:49:55 +0200
X-Authenticated-Sender-Id: domi@fortysix.ch
Content-Type: text/plain; charset=windows-1252
Mime-Version: 1.0 (Mac OS X Mail 7.3 \(1878.6\))
Subject: Re: maven-dependency-plugin unpacking aar format?
From: domi <domi@fortysix.ch>
In-Reply-To: <CAEBcyzpsG2dDB36aqZ3tVm7Gk=gKpvLq-qXRNzAEx=P8sEVXiA@mail.gmail.com>
Date: Tue, 22 Jul 2014 16:49:55 +0200
Content-Transfer-Encoding: quoted-printable
Message-Id: <61201C6A-08F4-4AEF-A592-81447C4B4DB7@fortysix.ch>
References: <CAA8BW8HFWKNmv_ZTE9wuYQMDJ_FxUzhkXAnW_g3wrVFjovj=cA@mail.gmail.com> <53CD80A3.6040302@gmx.de> <CAA8BW8FDv2vZhEg5OSOFkyWuRvUAt_Z_tYx7iV80MuQLEx2fcw@mail.gmail.com> <CAEBcyzq7aznBgKfVH6DzyzWnVmSwTs3zpfrsOZY1xTUnfqaF6g@mail.gmail.com> <BLU172-W40C66356CCF5989329FB7BAEF00@phx.gbl> <CAEBcyzpv85QdvChGKJXDkq1i8dQ3coF_hJuibOYkxfaGwcUvpA@mail.gmail.com> <CAA8BW8GoweJbtwFQZG3Rhshzo+-Zr5=MyeFJ9TqT8mvKhQ+A0g@mail.gmail.com> <CAEBcyzpsG2dDB36aqZ3tVm7Gk=gKpvLq-qXRNzAEx=P8sEVXiA@mail.gmail.com>
To: Maven Users List <users@maven.apache.org>
X-Mailer: Apple Mail (2.1878.6)
X-Virus-Checked: Checked by ClamAV on apache.org

I think to recall a thread on the dev list about plans to remove the =
unpack goal from the dependency plugin, but I can=92t find it anymore=85
regards Domi

On 22.07.2014, at 16:29, William Ferguson =
<william.ferguson@xandar.com.au> wrote:

> I totally agree that it makes sense for the dependency plugin to =
unpack the
> AAR just like all other archives.
>=20
> I just don't understand why you need the MDP to do so.
>=20
>=20
> On Tue, Jul 22, 2014 at 10:58 PM, David Hoffer <dhoffer6@gmail.com> =
wrote:
>=20
>> No that was just an example so I could create a sample project.  =
Don't read
>> too much into this.  They are just AAR dependencies (in my case they =
come
>> from our build not public).  The maven dependency plugin should =
handle
>> these no different than it handles jars/etc.
>>=20
>>=20
>>=20
>>=20
>> On Mon, Jul 21, 2014 at 11:32 PM, William Ferguson <
>> william.ferguson@xandar.com.au> wrote:
>>=20
>>> So an Android library is packaging WSDL inside itself and is =
expecting
>> you
>>> to use it at build time?
>>>=20
>>>=20
>>> On Tue, Jul 22, 2014 at 8:53 AM, Martin Gainty <mgainty@hotmail.com>
>>> wrote:
>>>=20
>>>> Here is an aar straight from Axis version example:
>>>>=20
>>>> //layout of version.aar:
>>>>=20
>>>>   created: META-INF/
>>>>  inflated: META-INF/MANIFEST.MF
>>>>   created: sample/
>>>>   created: sample/axisversion/
>>>>  inflated: sample/axisversion/Version.class
>>>>  inflated: META-INF/services.xml
>>>>=20
>>>>=20
>>>> //org.apache.axis2.deployment.DeploymentEngine axis code used to
>>>> populateService with .aar contents:
>>>>=20
>>>>    protected ArrayList populateService(AxisServiceGroup =
serviceGroup,
>>>>                                        URL servicesURL,
>>>>                                        String serviceName) throws
>>>> DeploymentException {
>>>>        try {
>>>>            serviceGroup.setServiceGroupName(serviceName);
>>>>            ClassLoader serviceClassLoader =3D =
Utils.createClassLoader(
>>>>                    new URL[]{servicesURL},
>>>>                    axisConfig.getServiceClassLoader(),
>>>>                    true,
>>>>                    (File)
>>>>=20
>> =
axisConfig.getParameterValue(Constants.Configuration.ARTIFACTS_TEMP_DIR),
>>>>                    axisConfig.isChildFirstClassLoading());
>>>>            String metainf =3D "meta-inf";
>>>>=20
>> serviceGroup.setServiceGroupClassLoader(serviceClassLoader);
>>>>            //processing wsdl.list
>>>>            InputStream wsdlfilesStream =3D
>>>>=20
>>>> serviceClassLoader.getResourceAsStream("meta-inf/wsdl.list");
>>>>            if (wsdlfilesStream =3D=3D null) {
>>>>                wsdlfilesStream =3D
>>>> serviceClassLoader.getResourceAsStream("META-INF/wsdl.list");
>>>>                if (wsdlfilesStream !=3D null) {
>>>>                    metainf =3D "META-INF";
>>>>                }
>>>>            }
>>>>            HashMap servicesMap =3D new HashMap();
>>>>            if (wsdlfilesStream !=3D null) {
>>>>                ArchiveReader reader =3D new ArchiveReader();
>>>>                BufferedReader input =3D new BufferedReader(new
>>>> InputStreamReader(wsdlfilesStream));
>>>>                String line;
>>>>                while ((line =3D input.readLine()) !=3D null) {
>>>>                    line =3D line.trim();
>>>>                    if (line.length() > 0 && line.charAt(0) !=3D =
'#') {
>>>>                        line =3D metainf + "/" + line;
>>>>                        try {
>>>>                            List services =3D
>>> reader.getAxisServiceFromWsdl(
>>>>=20
>>>> serviceClassLoader.getResourceAsStream(line),
>>>>                                    serviceClassLoader, line);
>>>>                            if (services !=3D null) {
>>>>                                for (Object service : services) {
>>>>                                    AxisService axisService =3D
>>>> (AxisService) service;
>>>>=20
>>> servicesMap.put(axisService.getName(),
>>>> axisService);
>>>>                                }
>>>>                            }
>>>>=20
>>>>                        } catch (Exception e) {
>>>>                            throw new DeploymentException(e);
>>>>                        }
>>>>                    }
>>>>                }
>>>>            }
>>>>            InputStream servicexmlStream =3D
>>>>=20
>>>> serviceClassLoader.getResourceAsStream("META-INF/services.xml");
>>>>            if (servicexmlStream =3D=3D null) {
>>>>                servicexmlStream =3D
>>>> serviceClassLoader.getResourceAsStream("meta-inf/services.xml");
>>>>            } else {
>>>>                metainf =3D "META-INF";
>>>>            }
>>>>            if (servicexmlStream =3D=3D null) {
>>>>                throw new DeploymentException(
>>>>=20
>>>> Messages.getMessage(DeploymentErrorMsgs.SERVICE_XML_NOT_FOUND,
>>>>                                servicesURL.toString()));
>>>>            }
>>>>            DescriptionBuilder builder =3D new
>>>> DescriptionBuilder(servicexmlStream, configContext);
>>>>            OMElement rootElement =3D builder.buildOM();
>>>>            String elementName =3D rootElement.getLocalName();
>>>>=20
>>>>            if (TAG_SERVICE.equals(elementName)) {
>>>>                AxisService axisService =3D null;
>>>>                String wsdlLocation =3D "META-INF/service.wsdl";
>>>>                InputStream wsdlStream =3D
>>>>=20
>>>> serviceClassLoader.getResourceAsStream(wsdlLocation);
>>>>                URL wsdlURL =3D =
serviceClassLoader.getResource(metainf +
>>>> "/service.wsdl");
>>>>                if (wsdlStream =3D=3D null) {
>>>>                    wsdlLocation =3D "META-INF/" + serviceName + =
".wsdl";
>>>>                    wsdlStream =3D serviceClassLoader
>>>>                            .getResourceAsStream(wsdlLocation);
>>>>                    wsdlURL =3D
>>> serviceClassLoader.getResource(wsdlLocation);
>>>>                }
>>>>                if (wsdlStream !=3D null) {
>>>>                    WSDL11ToAxisServiceBuilder =
wsdl2AxisServiceBuilder
>> =3D
>>>>                            new =
WSDL11ToAxisServiceBuilder(wsdlStream,
>>>> null, null);
>>>>                    File file =3D Utils.toFile(servicesURL);
>>>>                    if (file !=3D null && file.exists()) {
>>>>                        =
wsdl2AxisServiceBuilder.setCustomWSDLResolver(
>>>>                                new =
AARBasedWSDLLocator(wsdlLocation,
>>>> file, wsdlStream));
>>>>                        wsdl2AxisServiceBuilder.setCustomResolver(
>>>>                                new AARFileBasedURIResolver(file));
>>>>                    }
>>>>                    if (wsdlURL !=3D null) {
>>>>=20
>>>> wsdl2AxisServiceBuilder.setDocumentBaseUri(wsdlURL.toString());
>>>>                    }
>>>>                    axisService =3D
>>>> wsdl2AxisServiceBuilder.populateService();
>>>>                    axisService.setWsdlFound(true);
>>>>                    axisService.setCustomWsdl(true);
>>>>                    axisService.setName(serviceName);
>>>>                }
>>>>                if (axisService =3D=3D null) {
>>>>                    axisService =3D new AxisService(serviceName);
>>>>                }
>>>>=20
>>>>                axisService.setParent(serviceGroup);
>>>>                axisService.setClassLoader(serviceClassLoader);
>>>>=20
>>>>                ServiceBuilder serviceBuilder =3D new
>>>> ServiceBuilder(configContext, axisService);
>>>>                AxisService service =3D
>>>> serviceBuilder.populateService(rootElement);
>>>>=20
>>>>                ArrayList serviceList =3D new ArrayList();
>>>>                serviceList.add(service);
>>>>                return serviceList;
>>>>            } else if (TAG_SERVICE_GROUP.equals(elementName)) {
>>>>                ServiceGroupBuilder groupBuilder =3D new
>>>> ServiceGroupBuilder(rootElement, servicesMap,
>>>>                        configContext);
>>>>                ArrayList servicList =3D
>>>> groupBuilder.populateServiceGroup(serviceGroup);
>>>>                Iterator serviceIterator =3D servicList.iterator();
>>>>                while (serviceIterator.hasNext()) {
>>>>                    AxisService axisService =3D (AxisService)
>>>> serviceIterator.next();
>>>>                    String wsdlLocation =3D "META-INF/service.wsdl";
>>>>                    InputStream wsdlStream =3D
>>>>=20
>>>> serviceClassLoader.getResourceAsStream(wsdlLocation);
>>>>                    URL wsdlURL =3D
>>>> serviceClassLoader.getResource(wsdlLocation);
>>>>                    if (wsdlStream =3D=3D null) {
>>>>                        wsdlLocation =3D "META-INF/" + serviceName +
>>> ".wsdl";
>>>>                        wsdlStream =3D serviceClassLoader
>>>>                                .getResourceAsStream(wsdlLocation);
>>>>                        wsdlURL =3D
>>>>=20
>>>> serviceClassLoader.getResource(wsdlLocation);
>>>>                    }
>>>>                    if (wsdlStream !=3D null) {
>>>>                        WSDL11ToAxisServiceBuilder
>>> wsdl2AxisServiceBuilder
>>>> =3D
>>>>                                new
>>> WSDL11ToAxisServiceBuilder(wsdlStream,
>>>> axisService);
>>>>                        File file =3D Utils.toFile(servicesURL);
>>>>                        if (file !=3D null && file.exists()) {
>>>>=20
>>> wsdl2AxisServiceBuilder.setCustomWSDLResolver(
>>>>                                    new
>> AARBasedWSDLLocator(wsdlLocation,
>>>> file, wsdlStream));
>>>>                            =
wsdl2AxisServiceBuilder.setCustomResolver(
>>>>                                    new =
AARFileBasedURIResolver(file));
>>>>                        }
>>>>                        if (wsdlURL !=3D null) {
>>>>=20
>>>> wsdl2AxisServiceBuilder.setDocumentBaseUri(wsdlURL.toString());
>>>>                        }
>>>>                        axisService =3D
>>>> wsdl2AxisServiceBuilder.populateService();
>>>>                        axisService.setWsdlFound(true);
>>>>                        axisService.setCustomWsdl(true);
>>>>                        // Set the default message receiver for the
>>>> operations that were
>>>>                        // not listed in the services.xml
>>>>                        Iterator operations =3D
>>> axisService.getOperations();
>>>>                        while (operations.hasNext()) {
>>>>                            AxisOperation operation =3D =
(AxisOperation)
>>>> operations.next();
>>>>                            if (operation.getMessageReceiver() =3D=3D
>> null) {
>>>>=20
>>>> operation.setMessageReceiver(loadDefaultMessageReceiver(
>>>>=20
>>>> operation.getMessageExchangePattern(), axisService));
>>>>                            }
>>>>                        }
>>>>                    }
>>>>                }
>>>>                return servicList;
>>>>            }
>>>>        } catch (IOException e) {
>>>>            throw new DeploymentException(e);
>>>>        } catch (XMLStreamException e) {
>>>>            throw new DeploymentException(e);
>>>>        }
>>>>        return null;
>>>>    }
>>>>=20
>>>> does this answer your question?
>>>> Martin
>>>> ______________
>>>>=20
>>>>=20
>>>>> Date: Tue, 22 Jul 2014 07:56:55 +1000
>>>>> Subject: Re: maven-dependency-plugin unpacking aar format?
>>>>> From: william.ferguson@xandar.com.au
>>>>> To: users@maven.apache.org
>>>>>=20
>>>>> David, what the use case for unpacking the AAR?
>>>>>=20
>>>>>=20
>>>>> William
>>>>>=20
>>>>>=20
>>>>> On Tue, Jul 22, 2014 at 7:27 AM, David Hoffer <dhoffer6@gmail.com>
>>>> wrote:
>>>>>=20
>>>>>> Here is a simplified project showing my use-case, I hope this
>> helps.
>>>> Note
>>>>>> I'm using unpack-dependencies as the aar is a module in the same
>>>> project;
>>>>>> however I assume the same problem exists with unpack, if that's =
the
>>>> case
>>>>>> that would make the test project even simpler.
>>>>>>=20
>>>>>> <?xml version=3D"1.0" encoding=3D"UTF-8"?>
>>>>>>=20
>>>>>> <project xmlns=3D"http://maven.apache.org/POM/4.0.0" xmlns:xsi=3D"
>>>>>> http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation=3D"
>>>>>> http://maven.apache.org/POM/4.0.0
>>>>>> http://maven.apache.org/xsd/maven-4.0.0.xsd">
>>>>>>=20
>>>>>>    <modelVersion>4.0.0</modelVersion>
>>>>>>=20
>>>>>>    <groupId>com.company.project</groupId>
>>>>>>    <artifactId>service</artifactId>
>>>>>>    <version>1.0-SNAPSHOT</version>
>>>>>>=20
>>>>>>    <packaging>pom</packaging>
>>>>>>=20
>>>>>>    <dependencies>
>>>>>>        <!--note: maven-dependency-plug fails reporting that aar =
is
>>> not
>>>>>> supported-->
>>>>>>        <dependency>
>>>>>>            <groupId>com.company.project</groupId>
>>>>>>            <artifactId>axis-service</artifactId>
>>>>>>            <type>aar</type>
>>>>>>            <version>1.0-SNAPSHOT</version>
>>>>>>        </dependency>
>>>>>>        <!--note: I assume it will have the same problem unpacking
>> a
>>>> public
>>>>>> artifact such as this-->
>>>>>>        <dependency>
>>>>>>            <groupId>com.helpshift</groupId>
>>>>>>            <artifactId>android-aar</artifactId>
>>>>>>            <version>3.4.2</version>
>>>>>>            <type>aar</type>
>>>>>>        </dependency>
>>>>>>    </dependencies>
>>>>>>=20
>>>>>>    <build>
>>>>>>        <plugins>
>>>>>>            <plugin>
>>>>>>                <groupId>org.apache.maven.plugins</groupId>
>>>>>>                <artifactId>maven-dependency-plugin</artifactId>
>>>>>>                <executions>
>>>>>>                    <execution>
>>>>>>                        <id>unpack-axis-service</id>
>>>>>>                        <phase>generate-resources</phase>
>>>>>>                        <goals>
>>>>>>                            <goal>unpack-dependencies</goal>
>>>>>>                        </goals>
>>>>>>                        <configuration>
>>>>>>=20
>>>>>> <includeArtifactIds>axis-service</includeArtifactIds>
>>>>>>=20
>>>>>>=20
>>>>>>=20
>>>>=20
>>>=20
>> =
<outputDirectory>${project.build.directory}/generated-resources/axis</outp=
utDirectory>
>>>>>>=20
>>> <overWriteReleases>true</overWriteReleases>
>>>>>>=20
>>>> <overWriteSnapshots>true</overWriteSnapshots>
>>>>>>=20
>>>>>> <includes>META-INF/*.wsdl,META-INF/schema/**/*.xsd</includes>
>>>>>>                        </configuration>
>>>>>>                    </execution>
>>>>>>                </executions>
>>>>>>            </plugin>
>>>>>>        </plugins>
>>>>>>    </build>
>>>>>>=20
>>>>>> </project>
>>>>>>=20
>>>>>>=20
>>>>>>=20
>>>>>> On Mon, Jul 21, 2014 at 3:05 PM, Karl Heinz Marbaise <
>>>> khmarbaise@gmx.de>
>>>>>> wrote:
>>>>>>=20
>>>>>>> HI David,
>>>>>>>=20
>>>>>>>=20
>>>>>>>=20
>>>>>>>> I'm getting the following error trying to unpack some files
>> from
>>> an
>>>>>> aar.
>>>>>>>=20
>>>>>>>>  Is this not supported?  Is there any way to do this?
>>>>>>>>=20
>>>>>>>> Failed to execute goal
>>>>>>>>=20
>>>>=20
>> =
org.apache.maven.plugins:maven-dependency-plugin:2.8:unpack-dependencies
>>>>>>>> (unpack-service) on project service: Unknown archiver type: No
>>> such
>>>>>>>> archiver: 'aar'. -> [Help 1]
>>>>>>>>=20
>>>>>>>=20
>>>>>>> Could you please prepare a example project which reproduces the
>>>>>>> problem..so i can create a JIRA issue for this...
>>>>>>>=20
>>>>>>> Kind regards
>>>>>>> Karl-Heinz Marbaise
>>>>>>>=20
>>>>>>>=20
>>> =
---------------------------------------------------------------------
>>>>>>> To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
>>>>>>> For additional commands, e-mail: users-help@maven.apache.org
>>>>>>>=20
>>>>>>>=20
>>>>>>=20
>>>>=20
>>>>=20
>>>=20
>>=20


---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


