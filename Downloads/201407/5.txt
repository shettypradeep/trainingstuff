From users-return-136784-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Wed Jul 16 18:44:04 2014
Return-Path: <users-return-136784-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id DD5411071B
	for <apmail-maven-users-archive@www.apache.org>; Wed, 16 Jul 2014 18:44:04 +0000 (UTC)
Received: (qmail 93600 invoked by uid 500); 16 Jul 2014 18:44:03 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 93497 invoked by uid 500); 16 Jul 2014 18:44:03 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 93486 invoked by uid 99); 16 Jul 2014 18:44:03 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 16 Jul 2014 18:44:03 +0000
X-ASF-Spam-Status: No, hits=-0.1 required=5.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_MED,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: local policy)
Received: from [12.161.118.91] (HELO mx2.belden.com) (12.161.118.91)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 16 Jul 2014 18:44:00 +0000
X-AuditID: 0a01015b-b7f348e0000078f1-9f-53c6c7d7e024
Received: from bdcnotes1.belden.com ( [10.1.1.71])
	by mx2.belden.com (Service Ready) with SMTP id D3.FC.30961.7D7C6C35; Wed, 16 Jul 2014 14:43:35 -0400 (EDT)
In-Reply-To: <CADN69ymG8f7j19xuCtUqdXx8yJoLYgaNGuHiyrQcUApdhcUJxA@mail.gmail.com>
References: <OF1F05DF42.E00CE028-ON85257D17.0063A305-85257D17.00648730@belden.com> <CADN69ymG8f7j19xuCtUqdXx8yJoLYgaNGuHiyrQcUApdhcUJxA@mail.gmail.com>
To: "Maven Users List" <users@maven.apache.org>
MIME-Version: 1.0
Subject: Re: move data from pom to class or class to pom
X-KeepSent: B1EFD901:4439AF23-85257D17:00661468;
 type=4; name=$KeepSent
X-Mailer: Lotus Notes Release 8.5.3FP2 SHF99 September 04, 2012
From: Alejandro.Endo@miranda.com
Message-ID: <OFB1EFD901.4439AF23-ON85257D17.00661468-85257D17.0066DE86@belden.com>
Date: Wed, 16 Jul 2014 14:43:35 -0400
X-MIMETrack: Serialize by Router on BDCNotes1/BeldenCDT(Release 9.0 HF625|September 19, 2013) at
 07/16/2014 02:43:35 PM,
	Serialize complete at 07/16/2014 02:43:35 PM
Content-Type: multipart/alternative; boundary="=_alternative 0066DE4785257D17_="
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFnrDIsWRmVeSWpSXmKPExsXCxcjornv9+LFgg5VPRCwebb3O6MDo0f5U
	KIAxqoHRJimxpCw4Mz1P384mMS8vvySxJFUhJbU42VbJKTUnJTVPwSWzODknMTM3tUjXM9hf
	18LC1FJJITPFVslISaEgJzE5NTc1r8RWKbGgIDUvRcmOSwED2ACVZeYppOYl56dk5qXbKoWG
	uOlaKNm5eAY7J7SyZqzfvZ29YK1vxYx/21gbGPc6dDFyckgImEi87NzMBmGLSVy4tx7I5uIQ
	EpjPKNHy5gcLSIJTIFCi4ftFJojEdEaJp/uWM4EkRAT0JZYdvA9WxCsgKHFy5hMgm4NDWMBC
	4v3bJIihnhL/+74yQdj2Et8ffQArZxNQkJh7ZRMbRGuQxJPZ81hBWlkEVCWefgsCWSUhsJJR
	4uytp8wgNcwCARIfDm9ln8DIPwvJtllIUhC2jsSJVceYIWxtiUVXfrIvYGRZxciXW2GklwQO
	ar3k/NxNjJAYi97BeOyH6iFGAQ5GJR7ev3OPBQuxJpYVV+YeYpTgYFYS4Z02CyjEm5JYWZVa
	lB9fVJqTWnyIMQjozInMUtzJ+cD4zyuJNzYwIJKjJM779VNNsJBAOjABZKemFqQWwQxl4uAE
	WcolJVIMjOHUosTSkox4ULKJLwamG6kGRkZ71gOW8xmicyTemjDPyzF/Z7Yxx4/t7nnLcxul
	HSVKL99NC7G3+OT88acEk1ZDQIXR1SNzX+s5Ct/t8l46ZddHz8kiDlqZFayBfPGVynO9/cJM
	O6/fWmFs0e4svPXKgT+n1T4wTo87smD3hHf3Dimxeb/6kjFZdP+SbzOW7xa4e1rdS8SyWoml
	OCPRUIu5qDgRAFK6b5f/AgAA
X-Virus-Checked: Checked by ClamAV on apache.org

--=_alternative 0066DE4785257D17_=
Content-Type: text/plain; charset="US-ASCII"

Hi Curtis,

I *think* i see you point, but wouldn't that happen ONLY if the constant 
is public and referenced in a separate jar?? where it would be inlined in 
the referring class (right?). In my case the constant is package protected 
(it would be private if it wasn't because i need it in unit tests)

The problem with defining it in the manifest is that I use this constant 
in the property of an annotation of the class

@StaticServiceProperty(mandatory = true, type = "java.lang.String", name = 
"schemaVersion", value = SchemaProviderServiceImpl.SCHEMA_VERSION, 
immutable = true)
public class SchemaProviderServiceImpl

so I can't grab it from the manifest at runtime. I guess the way I phrased 
it in the original email implied the opposite, sorry about that

Alejandro Endo | Software Designer/Concepteur de logiciels 





From:   Curtis Rueden <ctrueden@wisc.edu>
To:     Maven Users List <users@maven.apache.org>, 
Date:   2014-07-16 14:27
Subject:        Re: move data from pom to class or class to pom
Sent by:        ctrueden.wisc@gmail.com



Hi Alejandro,

> I have a java class that has a constant in it (static final String).
> This string is a version number, e.g. "1.3.2-test".

Beware: the Java compiler often inlines constants, _including String
constants_, into classes that reference the value. So if you compile a
class "Foo" against version 1 of library "bar", then run with version 2 of
"bar" in the classpath, Foo will still see the constant value as 1 instead
of 2.

http://javasplitter.blogspot.com/2011/10/static-final-inline-trap.html

Much, much better to embed the version number into the JAR manifest, 
and/or
read it out of the Maven POM which the maven-jar-plugin embeds in the JAR
file.

Regards,
Curtis


On Wed, Jul 16, 2014 at 1:18 PM, <Alejandro.Endo@miranda.com> wrote:

> I have a java class that has a constant in it (static final String). 
This
> string is a version number, e.g. "1.3.2-test". I need to have this same
> value in a maven plugin configuration (the jaxb plugin) so I am 
wondering,
> is it better to keep the actual declaration in the code and somehow tell
> maven to take it from the code, or is it better to declare it in the pom
> and tell java to take the literal value to define the constant from the
> pom??
>
> I don't know how to do either so I would also like to hear some ideas. I
> am hoping i don't have to use resource filtering since having a source
> file as a resource is kind of problematic to me. It has to be ONLY that
> file that gets filtered, it would need to be in a non-standard location
> not src/main/java (maybe this is not true), and in general, it seems to 
me
> that treating source code as resource is counter-intuitive
>
> Has anyone else solved this issue with the DRY principle across 
behaviour
> and build system?
>
> The short background is that maven generates an XML schema via jaxb and
> this schema file is then made available at runtime via a service
>
> Thank you,
>
> Alejandro Endo | Software Designer/Concepteur de logiciels
>
>
> DISCLAIMER:
> Privileged and/or Confidential information may be contained in this
> message. If you are not the addressee of this message, you may not
> copy, use or deliver this message to anyone. In such event, you
> should destroy the message and kindly notify the sender by reply
> e-mail. It is understood that opinions or conclusions that do not
> relate to the official business of the company are neither given
> nor endorsed by the company.
> Thank You.
>


DISCLAIMER:
Privileged and/or Confidential information may be contained in this
message. If you are not the addressee of this message, you may not
copy, use or deliver this message to anyone. In such event, you
should destroy the message and kindly notify the sender by reply
e-mail. It is understood that opinions or conclusions that do not
relate to the official business of the company are neither given
nor endorsed by the company.
Thank You.

--=_alternative 0066DE4785257D17_=--

