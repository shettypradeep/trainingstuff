From users-return-137860-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Wed Nov 26 19:37:19 2014
Return-Path: <users-return-137860-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id 349E010F1B
	for <apmail-maven-users-archive@www.apache.org>; Wed, 26 Nov 2014 19:37:19 +0000 (UTC)
Received: (qmail 99228 invoked by uid 500); 26 Nov 2014 19:37:17 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 99144 invoked by uid 500); 26 Nov 2014 19:37:17 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 99125 invoked by uid 99); 26 Nov 2014 19:37:16 -0000
Received: from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 26 Nov 2014 19:37:16 +0000
X-ASF-Spam-Status: No, hits=-0.0 required=5.0
	tests=RCVD_IN_DNSWL_NONE,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (athena.apache.org: domain of khmarbaise@gmx.de designates 212.227.17.21 as permitted sender)
Received: from [212.227.17.21] (HELO mout.gmx.net) (212.227.17.21)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 26 Nov 2014 19:37:11 +0000
Received: from Karl-Heinzs-MacBook-Pro.local ([178.200.178.137]) by
 mail.gmx.com (mrgmx103) with ESMTPSA (Nemesis) id 0MNZVG-1XqyIu2Q7G-007EhL
 for <users@maven.apache.org>; Wed, 26 Nov 2014 20:36:46 +0100
Message-ID: <54762BD3.7090405@gmx.de>
Date: Wed, 26 Nov 2014 20:36:51 +0100
From: Karl Heinz Marbaise <khmarbaise@gmx.de>
Reply-To: info@soebes.de
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:31.0) Gecko/20100101 Thunderbird/31.2.0
MIME-Version: 1.0
To: Maven Users List <users@maven.apache.org>
Subject: Re: Bug? maven-ear-plugin 2.9.1 behaves different to 2.9
References: <20141126153102.511a9b53@dyn251.intern.xss.co.at>
In-Reply-To: <20141126153102.511a9b53@dyn251.intern.xss.co.at>
Content-Type: text/plain; charset=windows-1252; format=flowed
Content-Transfer-Encoding: 7bit
X-Provags-ID:  V03:K0:GX08f09+my777JQKR7LODEWpCrxArqX+Im5oujEe4gdGZtrQoCB
 g93qaoIXI3umE2aOX48R2Cm33Z0639ApeYfQ6IbU42dv0QmhEZG7FpfKR0Rq8HUkh0ytl2t
 cUgculmcVteD6wbgb0gcyV3MdDLper/+gDCU8pNkZFWoi4ZWme+JeLQbxcIgDF8CjTcPbau
 RpnkGjuV9QalrGSS4lZSQ==
X-UI-Out-Filterresults: notjunk:1;
X-Virus-Checked: Checked by ClamAV on apache.org

Hi Martin,


first can you create a project which reproduces the problem...otherwise 
it's really hard to drill down the issue...

Furthermore have you defined the dependencies in your ear module which 
should be skinnyfied...


Does you ear module contain other dependencies which could have the jars 
you don't like to have in your ear as a transitive dependency?

Can you post your pom file ?

On 11/26/14 3:31 PM, Martin Hoeller wrote:
> Hi!
>
> I'm using the maven-ear-plugin to create an EAR with a skinny WAR. This
> worked fine till I did an update from version 2.9 to version 2.9.1.
>
> The actual problem is quite hard to explain, so I'll try and start with
> an abstract and provide details below.
>
> The problem is, the skinny WAR contains a lot more JARs than it should,
> but not all that are in the original WAR artifact. So it seems the
> m-ear-p does build a skinny WAR but the decisions what JARs to pack
> into the WAR are wrong. Changing the used m-ear-p back to version 2.9
> fixes the problem, so this is definitely a regression in v2.9.1.
>
> The really strange thing is, this does not happen always! It only
> happens when I build my project the first time a day and a
> recent version of dependency of the project was not locally installed
> but was obtained from our local nexus. So it seems version information
> (or timestamps as all versions are SNAPSHOTs) of the dependencies
> matters.
>
> A concrete example to make this more clear:
>
> * My Project E is the EAR.
> * E depends on an artifact W, a WAR.
> * E and W have a common dependency D which is also a project of mine.
> * E, W and D are all built by a CI-server (jenkins) and SNAPSHOTs
>    are deployed to nexus during the night.
>
> In the WAR there is D.jar packaged in WEB-INF/lib.
> In the EAR there is D.jar packaged in lib/ and the skinny WAR should no
> longer contain D.jar.
>
> With  m-ear-p 2.9 this worked as expected. With version 2.9.1 when I
> build E with "mvn clean install" and D was not locally installed
> earlier this day, the skinny WAR is not skinny. It contains D.jar!
> Thus, D.jar is located twice in the EAR which is a bug.

That sound really strange cause maven-ear-plugin itself does not 
download artifacts...but we should try to drill down the problem...

>
> As soon as I do a "mvn clean install" for D, the building of E
> starts to work and the WAR is skinny again... till a nightly deploy
> provides a newer SNAPSHOT of D.
>
> Any ideas what could be wrong here?
>
> I'd be happy to provide a sample project but I'm not sure how to
> provide this as it also seems to depend on the infrastructure.

Hm...you say on one side it's a bug of maven-ear-plugin but here you say 
different... ?...


>
> TIA,
> - martin
>
> PS: I reported a (maybe) related issue half a year ago without any
>      feedback. Not sure if this could provide some extra info:
>      http://maven.40175.n5.nabble.com/bug-in-maven-ear-plugin-with-skinny-war-td5792646.html
>

Kind regards
Karl Heinz Marbaise

---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


