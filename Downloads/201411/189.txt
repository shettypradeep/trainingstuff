From users-return-137746-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Fri Nov 14 14:24:21 2014
Return-Path: <users-return-137746-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id AA800CD61
	for <apmail-maven-users-archive@www.apache.org>; Fri, 14 Nov 2014 14:24:21 +0000 (UTC)
Received: (qmail 12865 invoked by uid 500); 14 Nov 2014 14:24:19 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 12780 invoked by uid 500); 14 Nov 2014 14:24:19 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 12769 invoked by uid 99); 14 Nov 2014 14:24:19 -0000
Received: from mail-relay.apache.org (HELO mail-relay.apache.org) (140.211.11.15)
    by apache.org (qpsmtpd/0.29) with ESMTP; Fri, 14 Nov 2014 14:24:19 +0000
Received: from mail-qc0-f175.google.com (mail-qc0-f175.google.com [209.85.216.175])
	by mail-relay.apache.org (ASF Mail Server at mail-relay.apache.org) with ESMTPSA id 651F61A01AD
	for <users@maven.apache.org>; Fri, 14 Nov 2014 14:23:18 +0000 (UTC)
Received: by mail-qc0-f175.google.com with SMTP id b13so14363362qcw.6
        for <users@maven.apache.org>; Fri, 14 Nov 2014 06:24:16 -0800 (PST)
X-Received: by 10.140.108.9 with SMTP id i9mr1497722qgf.96.1415975056412; Fri,
 14 Nov 2014 06:24:16 -0800 (PST)
MIME-Version: 1.0
Received: by 10.140.43.7 with HTTP; Fri, 14 Nov 2014 06:23:56 -0800 (PST)
From: Robert Metzger <rmetzger@apache.org>
Date: Fri, 14 Nov 2014 15:23:56 +0100
Message-ID: <CAGr9p8CxcuY7L5UQkRAi2kSBLAYR4eDNkmshvebgp5fiGYDHCQ@mail.gmail.com>
Subject: Change dependency version through property
To: users@maven.apache.org
Content-Type: multipart/alternative; boundary=001a113a51983f9a9d0507d26266

--001a113a51983f9a9d0507d26266
Content-Type: text/plain; charset=UTF-8

Hi,

I'm a developer at the Apache Flink (incubating) project. I'm trying to
pass the version of a dependency using a property from the command line to
the binary build. But it seems that the version I've set is not respected
everywhere.


We have the following setup:
- flink-parent
   - flink-core
   - ... more modules ...
   - flink-yarn
   - flink-dist

The "flink-yarn" module (and others) have dependencies to Apache Hadoop. We
have a property (called hadoop.version) to have one place for setting the
Hadoop version. The default Hadoop version 2.2.0.

The "flink-dist" module is creating the binary release for Flink. It is
using the maven-assembly-plugin for that. All jars we depend on are placed
in the "lib" directory.
The "flink-dist" module has most of our modules (also the flink-yarn)
module as a dependency so that we can use the modules in the assembly.



What I'm trying to do is building Flink for a different Hadoop version, say
"2.2.0-cdh5.0.0-beta-2". Therefore, I'm passing this version as
"-Dhadoop.version=2.2.0-cdh5.0.0-beta-2".

However, some files from Hadoop "2.2.0" end up in the "lib" directory.

mvn dependency:tree reveals for "flink-dist":

[INFO] +- org.apache.flink:flink-yarn:jar:0.8-incubating-SNAPSHOT:compile
[INFO] |  +- org.apache.hadoop:hadoop-yarn-client:jar:2.2.0:compile
[INFO] |  |  +- org.apache.hadoop:hadoop-yarn-api:jar:2.2.0:compile
[INFO] |  |  +- org.apache.hadoop:hadoop-yarn-common:jar:2.2.0:compile

however, for "flink-yarn" the versions are correct:

[INFO] +-
org.apache.hadoop:hadoop-yarn-client:jar:2.2.0-cdh5.0.0-beta-2:compile
[INFO] |  +- commons-logging:commons-logging:jar:1.1.3:compile
[INFO] |  +- commons-lang:commons-lang:jar:2.6:compile

Here is the full dependency:tree output:
https://gist.github.com/rmetzger/70c5f35d4cfd06a91169


How can I create builds for different Hadoop versions using Maven?


Regards,
Robert

--001a113a51983f9a9d0507d26266--

