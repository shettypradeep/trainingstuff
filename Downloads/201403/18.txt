From users-return-135893-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Thu Mar 20 20:51:34 2014
Return-Path: <users-return-135893-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id A2E0310B97
	for <apmail-maven-users-archive@www.apache.org>; Thu, 20 Mar 2014 20:51:34 +0000 (UTC)
Received: (qmail 26037 invoked by uid 500); 20 Mar 2014 20:51:29 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 25910 invoked by uid 500); 20 Mar 2014 20:51:28 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 25902 invoked by uid 99); 20 Mar 2014 20:51:28 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 20 Mar 2014 20:51:28 +0000
X-ASF-Spam-Status: No, hits=-0.7 required=5.0
	tests=RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of mfriedenhagen@gmail.com designates 209.85.219.41 as permitted sender)
Received: from [209.85.219.41] (HELO mail-oa0-f41.google.com) (209.85.219.41)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 20 Mar 2014 20:51:23 +0000
Received: by mail-oa0-f41.google.com with SMTP id j17so1600367oag.28
        for <users@maven.apache.org>; Thu, 20 Mar 2014 13:51:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        bh=JJvI107k5JSjGE1FHaHUY2LDRIX25oY4iyMKqt6g+FE=;
        b=TCACPmR6srmvQvRld47k5G9w2EBBgy2vbQurlfLhBp5Uann5OZ5wX4X0x2QTcjnjLC
         31KP8E5u7v+0/xsBhLWXwd/aQMkNpVO8woRW8fz7Bn1AfTfWn9mLWF/nuFFlROtobh6l
         I2rKt/5hzIGq5VmWi0k+/Cr5Dvp8SRb5tHn6kAQ4BU1LpuCd1XuoRGrgwR/mzjn2LgDC
         /xW5TlGq1696K48VnHMaInqUKMXsr+BnWi4T2Rn4z/u7VBhb/k58aMKVKpNgkOcmfU4e
         wqcmj0jj7YivSHrhufEHNWsxzIsGWhobMz0bmQpQpFEWfD6ow8v7QfRk3y7c+60SDMwF
         FcIQ==
X-Received: by 10.182.81.197 with SMTP id c5mr9224980oby.40.1395348662259;
 Thu, 20 Mar 2014 13:51:02 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.182.193.9 with HTTP; Thu, 20 Mar 2014 13:50:22 -0700 (PDT)
In-Reply-To: <532B4246.9050606@gmail.com>
References: <532B4246.9050606@gmail.com>
From: Mirko Friedenhagen <mfriedenhagen@gmail.com>
Date: Thu, 20 Mar 2014 21:50:22 +0100
Message-ID: <CAK8jvqxqOQS34dbfjxsJFv4E17bAddK3zKww6syckRPwOv6z6Q@mail.gmail.com>
Subject: Re: Forcing Integration Tests Before a Release
To: Maven Users List <users@maven.apache.org>
Content-Type: text/plain; charset=UTF-8
X-Virus-Checked: Checked by ClamAV on apache.org

Eric,

when you use the maven-release-plugin a property performRelease is set
during release:perform.

So define in the pluginManagement section a definition for the
maven-failsafe-plugin in your build section:

<build>
   <pluginManagement>
       <plugins>
              <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-failsafe-plugin</artifactId>
                    <version>2.17</version>
                    <executions>
                        <execution>
                            <id>default-integration-test</id>
                            <goals>
                                <goal>integration-test</goal>
                            </goals>
                        </execution>
                        <execution>
                            <id>default-verify</id>
                            <goals>
                                <goal>verify</goal>
                            </goals>
                        </execution>
                    </executions>
                </plugin>
       </plugins>
   </pluginManagement>
</build>

and later on in your pom

    <profile>
            <id>release-run-failsafe</id>
            <activation>
                <property>
                    <name>performRelease</name>
                    <value>true</value>
                </property>
            </activation>
            <build>
                 <plugins>
                    <plugin>
                       <groupId>org.apache.maven.plugins</groupId>
                       <artifactId>maven-failsafe-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
    <profile>

So only during release:perform your integration tests will be executed
and success is verified.
Regards Mirko
--
http://illegalstateexception.blogspot.com/
https://github.com/mfriedenhagen/ (http://osrc.dfm.io/mfriedenhagen)
https://bitbucket.org/mfriedenhagen/


On Thu, Mar 20, 2014 at 8:32 PM, Eric Kolotyluk
<eric.kolotyluk@gmail.com> wrote:
> I am looking for some way to force my integration tests before a release,
> without explicitly using a profile.
>
> For example,
>
>       <plugin>
> <artifactId>maven-release-plugin</artifactId>
>         <configuration>
>           <preparationGoals>clean verify site</preparationGoals>
>         </configuration>
>       </plugin>
>
> But that doesn't work because unless the failsafe plugin is defined, it
> won't run the tests.
>
> I thought of doing something like
>
>   <profiles>
>     <profile>
>       <id>run-it</id>
>       <activation>
>         <file>
> <missing>target/failsafe-reports</missing>
>         </file>
>       </activation>
>       <build>
>         <plugins>
>           <plugin>
> <groupId>org.apache.maven.plugins</groupId>
> <artifactId>maven-failsafe-plugin</artifactId>
>             <version>2.17</version>
>             <executions>
>               <execution>
>                 <goals>
>                   <goal>integration-test</goal>
>                   <goal>verify</goal>
>                 </goals>
>               </execution>
>             </executions>
>           </plugin>
>         </plugins>
>       </build>
>     </profile>
>   </profiles>
>
> But that will cause the integration tests to be run after every clean.
>
> Is there some way I can trigger the integration tests when doing a release
>
>    mvn release:prepare
>
> without having to do
>
>    mvn release:prepare -P run-it
>
> Cheers, Eric
>
> ---------------------------------------------------------------------
> To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
> For additional commands, e-mail: users-help@maven.apache.org
>

---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


