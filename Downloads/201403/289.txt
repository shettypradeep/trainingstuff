From users-return-135914-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Mon Mar 24 11:57:47 2014
Return-Path: <users-return-135914-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id 46B8310B98
	for <apmail-maven-users-archive@www.apache.org>; Mon, 24 Mar 2014 11:57:47 +0000 (UTC)
Received: (qmail 90801 invoked by uid 500); 24 Mar 2014 11:57:42 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 90660 invoked by uid 500); 24 Mar 2014 11:57:40 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 90652 invoked by uid 99); 24 Mar 2014 11:57:39 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 24 Mar 2014 11:57:39 +0000
X-ASF-Spam-Status: No, hits=1.5 required=5.0
	tests=HTML_MESSAGE,RCVD_IN_DNSWL_LOW,SPF_PASS
X-Spam-Check-By: apache.org
Received-SPF: pass (nike.apache.org: domain of henrik.gram@gmail.com designates 209.85.213.175 as permitted sender)
Received: from [209.85.213.175] (HELO mail-ig0-f175.google.com) (209.85.213.175)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 24 Mar 2014 11:57:34 +0000
Received: by mail-ig0-f175.google.com with SMTP id ur14so7509189igb.2
        for <users@maven.apache.org>; Mon, 24 Mar 2014 04:57:12 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to
         :content-type;
        bh=BHbIbXbwnkT+aHXydjrj/HuMylVkyP/PtYSC0hAmg+Y=;
        b=nWxfZZRN1IPwXoRGgb+dP9XMjP/XxMZkW1y2Uo7Tbh91r2u+rhVvPFtsN+5K2oUvc4
         W5a8kl83bJ8arYNb2HI2t1EYxLrxMZDmN0ypmYlGXdZU1hZoHkIzplhLmEP4h5OHpD5w
         c0PcYmqC9eTILDZinY/JWtf+CTwvxXKD551PIsPY8WKymEblPKbp3R9ulV1UEpuqO4PX
         O0II1Jvrfv0Yf4LzmTad8qCIK2Wr4ueLPSycdcSQvVuIIG5tm093itG6fzpBi6tU7RXI
         8zg9yMz/qSazmZZjnNk86HI1Wx+B6G76Y5xIl2GSO6tGHXT9BFbKyjkXQb9yeaF+P4AC
         i9RQ==
X-Received: by 10.43.61.206 with SMTP id wx14mr5030339icb.43.1395662232747;
 Mon, 24 Mar 2014 04:57:12 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.50.93.69 with HTTP; Mon, 24 Mar 2014 04:56:52 -0700 (PDT)
In-Reply-To: <CAKDUN1s0QeSm3_oNyTQjx7U6+Ln0iu0MOgPmCpm8d87fUT5qdA@mail.gmail.com>
References: <CAMLk=nP5TeMTAp5yNP8PGZSYSc-LAqLn3UTu3Npz+18L03aN1A@mail.gmail.com>
 <CANWgJS75c4JPWRStq9p+J21xVyWxgZq1q9fcqdkxLgv+UnwaVg@mail.gmail.com>
 <CAMLk=nP2-5=Na+nHweV9wjPDS-NUFOij=vKMtgrc9fHzxGPqPQ@mail.gmail.com> <CAKDUN1s0QeSm3_oNyTQjx7U6+Ln0iu0MOgPmCpm8d87fUT5qdA@mail.gmail.com>
From: =?ISO-8859-1?Q?Henrik_=D8sterlund_Gram?= <henrik.gram@gmail.com>
Date: Mon, 24 Mar 2014 12:56:52 +0100
Message-ID: <CAMLk=nOvRKYWHSsTfivwSvVTy9U7XWdNj-uGqMh4g994YMkSnw@mail.gmail.com>
Subject: Re: properties that are not being resolved
To: Maven Users List <users@maven.apache.org>
Content-Type: multipart/alternative; boundary=bcaec51f990f9c05b104f558effc
X-Virus-Checked: Checked by ClamAV on apache.org

--bcaec51f990f9c05b104f558effc
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Ok, I see.

Any chance of such a change making it into the official ear-plugin?  I
think it would be generally useful to be able to reference properties in
the env-entry values.  Could post a pull request if desired, but judging by
the months old ones at https://github.com/apache/maven-plugins/pulls it
doesn't appear those are being processed by anyone.  Is there another way
to suggest that change be implemented?

Regards,
Henrik Gram



On Mon, Mar 24, 2014 at 9:13 AM, Anders Hammar <anders@hammar.net> wrote:

> It doesn't matter which plugin you use to set the property. What does
> matter is when the property substitution takes place. It normally happens
> in the very beginning of the Maven build when the pom is read, before the
> build lifecycle is executed and way before your plugin is executed. So yo=
u
> need the plugin (where you use the created property) to do an "extra"
> property substition step as you describe in your code.
>
> /Anders
>
>
> On Mon, Mar 24, 2014 at 9:04 AM, Henrik =D8sterlund Gram <
> henrik.gram@gmail.com> wrote:
>
> > The one at
> > http://mojo.codehaus.org/buildnumber-maven-plugin/create-mojo.html ?  I=
t
> > states in the first couple of lines that it only works with subversion
> and
> > I'm using git.
> >
> > Aside from that, I can't really see why it would make a difference; how
> > many ways are there to set properties?  I did establish that the
> properties
> > are indeed set as I can print them via the ant-run plugin and via the a
> > modified ear-plugin.
> >
> >
> >
> > On Mon, Mar 24, 2014 at 8:28 AM, Baptiste Mathus <bmathus@batmat.net>
> > wrote:
> >
> > > Hi,
> > > Out of curiosity, why don't you use the seemingly equivalent mojo
> > > buildnumber maven plugin? May not be your issue, but may be the plugi=
n
> > > you're using doesn't create properties in the right way (no offense,
> just
> > > trying to guess)?
> > > My 2 cents
> > > Le 23 mars 2014 22:37, "Henrik =D8sterlund Gram" <henrik.gram@gmail.c=
om>
> a
> > > =E9crit :
> > >
> > > > I stumbled over some rather strange behaviour regarding properties.
>  It
> > > > seems properties generated by one plugin are not always resolved fo=
r
> > > other
> > > > plugins and I can't figure out why.
> > > >
> > > > I use a plugin to make info about the git branch available in the
> > > > properties so it can be passed to other plugins.  The particular
> plugin
> > > > does not seem important, but I've included it here for sake of
> > > > completeness:
> > > >
> > > > <plugin>
> > > > <groupId>com.code54.mojo</groupId>
> > > > <artifactId>buildversion-plugin</artifactId>
> > > >  <version>1.0.3</version>
> > > > <configuration>
> > > > <tstamp_format>yyyy.MM.dd HH:mm</tstamp_format>
> > > >  </configuration>
> > > > <executions>
> > > > <execution>
> > > >  <goals>
> > > > <goal>set-properties</goal>
> > > > </goals>
> > > >  </execution>
> > > > </executions>
> > > > </plugin>
> > > >
> > > > But when I referenced the properties set by the plugin in an env
> entry
> > > for
> > > > the maven ear plugin, the properties were not resolved at all:
> > > >
> > > > <envEntries>
> > > > <env-entry>
> > > > <description>Middleware build information</description>
> > > >  <env-entry-name>java:app/env/sw-version</env-entry-name>
> > > > <env-entry-type>java.lang.String</env-entry-type>
> > > >  <env-entry-value>${build-commit} @ ${build-tstamp} built on
> > > > ${maven.build.timestamp}</env-entry-value>
> > > > </env-entry>
> > > > </envEntries>
> > > >
> > > > Just to be sure, I used the latest maven and tried both version 2.9
> of
> > > the
> > > > plugin and the latest from the repo with the same result.
> > > >
> > > > The only way I managed to fix this was to patch the maven-ear-plugi=
n
> > > > itself, adding the following code in
> > > GenerateApplicationXmlMojo.execute():
> > > >
> > > > // Fix env variable substitutions
> > > > Properties props =3D project.getProperties();
> > > > PlexusConfiguration[] entries =3D envEntries.getChildren();
> > > > if (entries !=3D null) {
> > > >     for (PlexusConfiguration entry : entries) {
> > > >         if ("env-entry".equals(entry.getName())) {
> > > >             PlexusConfiguration[] envEntryChildren =3D
> > entry.getChildren();
> > > >             if (envEntryChildren !=3D null) {
> > > >                 for (PlexusConfiguration envEntryChild :
> > > envEntryChildren)
> > > > {
> > > >
> > > >
> envEntryChild.setValue(StrSubstitutor.replace(envEntryChild.getValue(),
> > > > props));
> > > >                 }
> > > >             }
> > > >         }
> > > >     }
> > > > }
> > > >
> > > > Then it worked just fine, but I don't understand why this is
> necessary.
> > >  I
> > > > thought whatever called the plugin was supposed to have done the
> > variable
> > > > substitution already.  So clearly the properties were present at th=
e
> > time
> > > > of executing the plugin, but they werent being automaticly
> substituted.
> > > >
> > > > To add to the confusion, using ${project.version} in the
> > env-entry-value
> > > > was resolved just fine, but just not the properties coming from
> another
> > > > plugin despite the plugins being run in the correct order.
> > > >
> > > > To further add to the confusion, I then used maven ant-run plugin,
> > > echoing
> > > > the values of properties which worked just fine (!)
> > > >
> > > > While I solved the problem for me by making a locally patched versi=
on
> > of
> > > > the ear plugin, it's not really a solution I favour, so I hope
> someone
> > > can
> > > > provide a better and more permanent fix.
> > > >
> > > > Regards,
> > > > Henrik Gram
> > > >
> > >
> >
>

--bcaec51f990f9c05b104f558effc--

