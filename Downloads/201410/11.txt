From users-return-137431-apmail-maven-users-archive=maven.apache.org@maven.apache.org  Wed Oct  1 02:05:00 2014
Return-Path: <users-return-137431-apmail-maven-users-archive=maven.apache.org@maven.apache.org>
X-Original-To: apmail-maven-users-archive@www.apache.org
Delivered-To: apmail-maven-users-archive@www.apache.org
Received: from mail.apache.org (hermes.apache.org [140.211.11.3])
	by minotaur.apache.org (Postfix) with SMTP id 5C40C1750E
	for <apmail-maven-users-archive@www.apache.org>; Wed,  1 Oct 2014 02:05:00 +0000 (UTC)
Received: (qmail 4366 invoked by uid 500); 1 Oct 2014 02:04:58 -0000
Delivered-To: apmail-maven-users-archive@maven.apache.org
Received: (qmail 4276 invoked by uid 500); 1 Oct 2014 02:04:58 -0000
Mailing-List: contact users-help@maven.apache.org; run by ezmlm
Precedence: bulk
List-Unsubscribe: <mailto:users-unsubscribe@maven.apache.org>
List-Help: <mailto:users-help@maven.apache.org>
List-Post: <mailto:users@maven.apache.org>
List-Id: "Maven Users List" <users.maven.apache.org>
Reply-To: "Maven Users List" <users@maven.apache.org>
Delivered-To: mailing list users@maven.apache.org
Received: (qmail 4265 invoked by uid 99); 1 Oct 2014 02:04:58 -0000
Received: from nike.apache.org (HELO nike.apache.org) (192.87.106.230)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 01 Oct 2014 02:04:58 +0000
X-ASF-Spam-Status: No, hits=0.0 required=5.0
	tests=
X-Spam-Check-By: apache.org
Received-SPF: unknown (nike.apache.org: error in processing during lookup of martin.cedervall@commerce.wa.gov.au)
Received: from [216.139.236.26] (HELO sam.nabble.com) (216.139.236.26)
    by apache.org (qpsmtpd/0.29) with ESMTP; Wed, 01 Oct 2014 02:04:32 +0000
Received: from [192.168.236.26] (helo=sam.nabble.com)
	by sam.nabble.com with esmtp (Exim 4.72)
	(envelope-from <martin.cedervall@commerce.wa.gov.au>)
	id 1XZ9HG-0000d5-Tm
	for users@maven.apache.org; Tue, 30 Sep 2014 19:04:27 -0700
Date: Tue, 30 Sep 2014 19:04:26 -0700 (PDT)
From: ghostwolf59 <martin.cedervall@commerce.wa.gov.au>
To: users@maven.apache.org
Message-ID: <1412129066917-5807497.post@n5.nabble.com>
Subject: maven dependency issue (sqljdbc4.jar not picked up during junit
 test)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
X-Virus-Checked: Checked by ClamAV on apache.org

Hi,
I am scratching my head on this one.

Have this component that rely on MSSQL Server 2008.

The one developed this rely on sqljdbc4.jar (v3.0) being added to the local
java installation (JAVA_HOME/jre/lib/etc/

I found this a bit silly that each developer working on this component need
to tweak their local java runtime env like this and thought that simply
adding this jar to the pom dependency should resolve this easily.
So I added the sqljdbc4.jar (v3.0) to our internal repo and updated the
project pom.xml dependency to include this...
        <dependency>
            <groupId>org.Microsoft.jdbc</groupId>
            <artifactId>sqljdbc4</artifactId>
            <version>3.0</version>
            <scope>test</scope>
        </dependency>

However, when doing so the junit test fail at a very early stage... (85
errors)

The following exception is thrown when using sqljdbc4.jar...
java.lang.IllegalStateException: Failed to load ApplicationContext
	at
org.springframework.test.context.TestContext.getApplicationContext(TestContext.java:308)
	at
org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:109)
	at
org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:75)
	at
org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:333)
	at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner.createTest(SpringJUnit4ClassRunner.java:220)
	at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner$1.runReflectiveCall(SpringJUnit4ClassRunner.java:301)
	at
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner.methodBlock(SpringJUnit4ClassRunner.java:303)
	at
org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:240)
	at
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
Caused by: org.springframework.beans.factory.BeanCreationException: Error
creating bean with name 'underInvestigationDAO': Injection of autowired
dependencies failed; 
nested exception is org.springframework.beans.factory.BeanCreationException: 
Could not autowire field: private org.hibernate.SessionFactory
au.xxx.xx.xxxxxx.service.licence.search.UnderInvestigationDAO.sessionFactory; 
nested exception is org.springframework.beans.factory.BeanCreationException: 
*Error creating bean with name 'licenceServiceUserSessionFactory' defined in
class path resource [WEB-INF/test-web-application-context.xml]: *
Invocation of init method failed; nested exception is
java.lang.AssertionError


Failing to use sqljdbc4.jar made me try to use sqljdbc.jar instead, it runs
longer but still fail (7 failures)
	<dependency>
		<groupId>org.Microsoft.jdbc</groupId>
		<artifactId>sqljdbc</artifactId>
        <version>3.0</version>
        <scope>test</scope>
	</dependency>
 
The following exception is thrown when using sqljdbc.jar...
java.lang.UnsupportedOperationException: Java Runtime Environment (JRE)
version 1.6 is not supported by this driver. Use the sqljdbc4.jar class
library, which provides support for JDBC 4.0.
	at
com.microsoft.sqlserver.jdbc.SQLServerConnection.<init>(SQLServerConnection.java:238)
	at
com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.java:841)
	at java.sql.DriverManager.getConnection(DriverManager.java:582)
	at java.sql.DriverManager.getConnection(DriverManager.java:154)
	at
org.springframework.jdbc.datasource.DriverManagerDataSource.getConnectionFromDriverManager(DriverManagerDataSource.java:173)
	at
org.springframework.jdbc.datasource.DriverManagerDataSource.getConnectionFromDriver(DriverManagerDataSource.java:164)
	at
org.springframework.jdbc.datasource.AbstractDriverBasedDataSource.getConnectionFromDriver(AbstractDriverBasedDataSource.java:149)
	at
org.springframework.jdbc.datasource.AbstractDriverBasedDataSource.getConnection(AbstractDriverBasedDataSource.java:119)
	at
org.springframework.orm.hibernate3.LocalDataSourceConnectionProvider.getConnection(LocalDataSourceConnectionProvider.java:81)
	at
org.hibernate.jdbc.ConnectionManager.openConnection(ConnectionManager.java:446)
	at
org.hibernate.jdbc.ConnectionManager.getConnection(ConnectionManager.java:167)
	at
org.hibernate.jdbc.AbstractBatcher.prepareQueryStatement(AbstractBatcher.java:161)
	at org.hibernate.loader.Loader.prepareQueryStatement(Loader.java:1616)
	at org.hibernate.loader.Loader.doQuery(Loader.java:717)
	at
org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:270)



I've done this in the past on other components using v4.0 without any issues
so I thought this one would be dead simple, but I don;t seem to be able to
do this successfully without 
adding sqljdbc4.jar to the JAVA_HOME/jre/lib/etc/ folder. - Once there (and
without any pom dependency) it runs without any issues.

Don't understand why this is a problem - other components I've worked on
that connects to MS SQL Server 12 using sqljdbc4.jar (v4.0) works perfectly.
Using sqljdbc4.jar as part of my pom dependency prevents the
WEB-INF/test-web-application-context.xml to be resolved
But by adding the sqljdbc4.jar to the JAVA_HOME/jre/lib/etc/ folder works! -
Why???? 
Is this something linked to the v3.0 or...?

Bottom line is that I don't want developers to be forced to tweak their
local java environment like this where I would expect maven to sort the pom
dependency, but it doesn't!

The component is built using ...
* jdk1.6.0_33
* apache-maven-3.0.4
* Junit 4.11
* spring 3.0.4.RELEASE
* hibernate 3.5.6-Final





-----
good @ being sucked @
--
View this message in context: http://maven.40175.n5.nabble.com/maven-dependency-issue-sqljdbc4-jar-not-picked-up-during-junit-test-tp5807497.html
Sent from the Maven - Users mailing list archive at Nabble.com.

---------------------------------------------------------------------
To unsubscribe, e-mail: users-unsubscribe@maven.apache.org
For additional commands, e-mail: users-help@maven.apache.org


